"""Сервис для эхо-функциональности.

Этот сервис содержит бизнес-логику обработки эхо-сообщений.
Он не зависит от aiogram и Telegram, поэтому его легко тестировать.
"""


class EchoService:
    """Сервис для обработки эхо-сообщений.
    
    Этот класс обрабатывает текстовые сообщения и возвращает результат.
    Он не знает о Telegram - это чистая бизнес-логика.
    """
    
    @staticmethod
    def process_message(text: str | None) -> str:
        """Обрабатывает текстовое сообщение и возвращает ответ.
        
        Если сообщение является числом (целым или дробным), возвращает число + 1.
        Если сообщение содержит обычный текст, возвращает его обратно (эхо).
        Если текста нет, возвращает сообщение об ошибке.
        
        Args:
            text: Текст сообщения или None, если текста нет
            
        Returns:
            str: Ответ бота на сообщение (число + 1 для чисел, эхо для текста)
        """
        if text is None or text.strip() == "":
            return "Получено сообщение, но я могу повторять только текстовые сообщения."
        
        # Проверяем, является ли сообщение числом
        # Убираем пробелы и пытаемся преобразовать в число
        text_cleaned = text.strip()
        
        # Пробуем преобразовать в целое число
        try:
            number = int(text_cleaned)
            # Если это число, возвращаем число + 1
            return str(number + 1)
        except ValueError:
            # Если не число, пробуем преобразовать в дробное число
            try:
                number = float(text_cleaned)
                # Если это дробное число, возвращаем число + 1
                return str(number + 1)
            except ValueError:
                # Если не число вообще, возвращаем текст как есть (эхо)
                return text
    
    @staticmethod
    def is_text_message(text: str | None) -> bool:
        """Проверяет, является ли сообщение текстовым.
        
        Args:
            text: Текст сообщения или None
            
        Returns:
            bool: True, если сообщение содержит текст, False иначе
        """
        return text is not None and text.strip() != ""
