"""–†–æ—É—Ç–µ—Ä –¥–ª—è —ç—Ö–æ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.

–†–æ—É—Ç–µ—Ä - —ç—Ç–æ –∫–∞–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ –ø–∏—Å–µ–º –Ω–∞ –ø–æ—á—Ç–µ.
–ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ä–æ—É—Ç–µ—Ä —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –Ω–µ–≥–æ –∏ —Ä–µ—à–∞–µ—Ç:
"–≠—Ç–æ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ? –¢–æ–≥–¥–∞ –≤—ã–∑–æ–≤–∏ —Ñ—É–Ω–∫—Ü–∏—é echo_handler!"

–ü—Ä–µ–¥—Å—Ç–∞–≤—å –ø–æ—á—Ç–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ: –ø–∏—Å—å–º–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç, –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∞–¥—Ä–µ—Å
–∏ —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –†–æ—É—Ç–µ—Ä –¥–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏!
"""
import logging
from aiogram import Router
from aiogram.types import Message
from aiogram.exceptions import TelegramNetworkError, TelegramAPIError

from bot.keyboards.common import get_main_menu, get_echo_menu

# –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ (–¥–Ω–µ–≤–Ω–∏–∫)
logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞—ë–º —Ä–æ—É—Ç–µ—Ä (—Å–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π)
# –≠—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
echo_router = Router()


@echo_router.message(lambda message: message.text == "üìù –≠—Ö–æ")
async def cmd_echo_mode(message: Message) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–≠—Ö–æ" –≤ –º–µ–Ω—é.
    
    –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–≠—Ö–æ", –±–æ—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —ç—Ö–æ-—Ä–µ–∂–∏–º
    –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –º–µ–Ω—é.
    """
    try:
        await message.answer(
            "üìù –≠—Ö–æ-—Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω!\n\n"
            "–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –ª—é–±–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏ —è –ø–æ–≤—Ç–æ—Ä—é –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ.",
            reply_markup=get_echo_menu()
        )
    except (TelegramNetworkError, TelegramAPIError) as e:
        logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}")


@echo_router.message(lambda message: message.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é")
async def cmd_back_to_menu(message: Message) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é".
    
    –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç —ç—Ç—É –∫–Ω–æ–ø–∫—É, –±–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
    """
    try:
        await message.answer(
            "üè† –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é!",
            reply_markup=get_main_menu()
        )
    except (TelegramNetworkError, TelegramAPIError) as e:
        logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}")


@echo_router.message()
async def echo_handler(message: Message) -> None:
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ.
    
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è, –∫—Ä–æ–º–µ –∫–æ–º–∞–Ω–¥—ã /start.
    @echo_router.message() –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–∑–Ω–∞—á–∞–µ—Ç "–æ–±—Ä–∞–±–æ—Ç–∞–π –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ".
    –≠—Ç–æ –∫–∞–∫ –ª–æ–≤—É—à–∫–∞: –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø–æ–ø–∞–ª–æ –≤ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–Ω–æ –ø–æ–ø–∞–¥—ë—Ç —Å—é–¥–∞.
    """
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å—Ç—å –ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç?
        if message.text:
            # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –µ—Å—Ç—å - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            # message.text - —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            # –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            await message.answer(
                message.text,
                reply_markup=get_echo_menu()
            )
        else:
            # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–æ—Ç–æ, —Å—Ç–∏–∫–µ—Ä, –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ),
            # –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ –º—ã –º–æ–∂–µ–º –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
            await message.answer(
                "–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–æ —è –º–æ–≥—É –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.",
                reply_markup=get_echo_menu()
            )
    except TelegramNetworkError as e:
        # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏ (–Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Ç–∞–π–º–∞—É—Ç),
        # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –ª–æ–≥, –Ω–æ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞
        # –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        logger.error(f"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")
    except TelegramAPIError as e:
        # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ API Telegram (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω, –±–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ —Ç.–¥.),
        # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –ª–æ–≥
        logger.error(f"–û—à–∏–±–∫–∞ API Telegram: {e}")
    except Exception as e:
        # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –¥—Ä—É–≥–∞—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞,
        # —Ç–æ–∂–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ—ë –≤ –ª–æ–≥
        logger.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
