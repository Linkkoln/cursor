# Telegram Эхо-бот

Простой Telegram-бот на Python, который повторяет все текстовые сообщения пользователя.

## Технологии

- **aiogram 3.13.1** — фреймворк для работы с Telegram Bot API
- **python-dotenv** — управление переменными окружения
- **pytest** — для тестирования

## Установка

1. Создайте виртуальное окружение и активируйте его:
```bash
python3 -m venv .venv
source .venv/bin/activate  # для macOS/Linux
# или для Windows:
# .venv\Scripts\activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` и добавьте токен бота (получите у [@BotFather](https://t.me/BotFather)):
```
BOT_TOKEN=ваш_токен_от_BotFather
```

## Запуск

Запустите бота одним из способов:

```bash
python -m src.bot.main
```

или

```bash
python -m src.bot
```

## Переменные окружения

- `BOT_TOKEN` — токен бота, полученный от @BotFather (обязательно)

## Структура проекта

```
.
├── README.md
├── requirements.txt
├── pytest.ini              # Конфигурация pytest
├── .env.example
├── src/
│   └── bot/
│       ├── __init__.py
│       ├── __main__.py
│       ├── main.py          # Точка входа и запуск бота
│       ├── config.py         # Загрузка конфигурации
│       ├── keyboards/        # Клавиатуры бота
│       │   ├── __init__.py
│       │   └── common.py    # Общие клавиатуры
│       ├── routers/          # Роутеры (обработчики сообщений)
│       │   ├── __init__.py
│       │   ├── start.py      # Команда /start
│       │   ├── help.py       # Команда /help
│       │   └── echo.py       # Эхо-обработчик
│       └── services/         # Бизнес-логика (независимая от Telegram)
│           ├── __init__.py
│           ├── echo.py       # Сервис эхо-функциональности
│           └── message.py    # Сервис сообщений
└── tests/                    # Тесты
    ├── __init__.py
    ├── test_echo_service.py  # Тесты сервиса эхо
    ├── test_message_service.py  # Тесты сервиса сообщений
    └── test_keyboards.py     # Тесты клавиатур
```

## Как это работает

1. Бот получает токен из переменных окружения через `config.py`
2. В `main.py` создаётся экземпляр бота и диспетчер
3. Роутеры обрабатывают входящие сообщения и команды
4. Бизнес-логика находится в сервисах (`services/`), которые не зависят от Telegram
5. При получении текстового сообщения сервис обрабатывает его, и бот отправляет ответ пользователю

### Архитектура

Проект следует принципам Clean Architecture:
- **Роутеры** (`routers/`) — только обработка Telegram-событий, без бизнес-логики
- **Сервисы** (`services/`) — бизнес-логика, независимая от Telegram API
- **Клавиатуры** (`keyboards/`) — создание UI-компонентов
- **Тесты** (`tests/`) — unit-тесты для сервисного слоя

## Команды

- `/start` — запустить бота и показать меню
- `/help` — показать справку по использованию бота

## Тестирование

Проект покрыт unit-тестами для сервисного слоя. Для запуска тестов:

```bash
# Активируйте виртуальное окружение
source .venv/bin/activate

# Запустите все тесты
pytest

# Запустите тесты с подробным выводом
pytest -v

# Запустите конкретный тестовый файл
pytest tests/test_echo_service.py
```

### Структура тестов

- `tests/test_echo_service.py` — тесты для сервиса эхо-функциональности
- `tests/test_message_service.py` — тесты для сервиса сообщений
- `tests/test_keyboards.py` — тесты для клавиатур

Тесты проверяют бизнес-логику сервисов, которая не зависит от Telegram API.
